{% extends "base.html" %}

{% block content %}
{% if error %}
<article style="border-left: 4px solid var(--pico-color-red-500); padding: 1rem;">
    {{ error }}
</article>
{% endif %}

<form method="post" action="/schedule" id="mainForm">
    {% for cat in category_order %}
    {% set config = categories[cat] %}
    <details {% if loop.first %}open{% endif %}>
        <summary>
            <label>
                <input type="checkbox" name="{{ cat }}_enabled" value="1" {% if loop.first %}checked{% endif %}>
                {{ cat }} ({{ config.match_duration }} min + {{ config.break_duration }} min pausa)
            </label>
        </summary>
        <div class="grid">
            <label>
                Numero di squadre
                <select name="{{ cat }}_num_teams" class="team-count-select" data-category="{{ cat }}">
                    {% for n in range(3, 9) %}
                    <option value="{{ n }}" {% if n == 6 %}selected{% endif %}>{{ n }}</option>
                    {% endfor %}
                </select>
            </label>
            <label>
                Numero di campi
                <select name="{{ cat }}_num_fields">
                    {% for n in range(1, 5) %}
                    <option value="{{ n }}" {% if n == 2 %}selected{% endif %}>{{ n }}</option>
                    {% endfor %}
                </select>
            </label>
            <label>
                Orario di inizio
                <input type="time" name="{{ cat }}_start_time" value="09:00">
            </label>
        </div>
        <label>
            <input type="checkbox" name="{{ cat }}_dedicated_referees" value="1">
            Arbitri dedicati (la squadra che arbitra non gioca)
        </label>
        <fieldset id="{{ cat }}_team_names">
            <legend>Nomi squadre (opzionale)</legend>
            <div class="grid" id="{{ cat }}_names_grid">
                {% for i in range(1, 9) %}
                <input type="text" name="{{ cat }}_team_{{ i }}" placeholder="Squadra {{ i }}"
                       class="{{ cat }}-team-input" {% if i > 6 %}style="display:none"{% endif %}>
                {% endfor %}
            </div>
        </fieldset>
    </details>
    {% endfor %}

    <button type="submit">Genera Calendari</button>
</form>
{% endblock %}

{% block scripts %}
<script>
document.querySelectorAll('.team-count-select').forEach(select => {
    select.addEventListener('change', function() {
        const cat = this.dataset.category;
        const count = parseInt(this.value);
        document.querySelectorAll('.' + cat + '-team-input').forEach((input, idx) => {
            input.style.display = idx < count ? '' : 'none';
        });
    });
});
</script>
{% endblock %}
